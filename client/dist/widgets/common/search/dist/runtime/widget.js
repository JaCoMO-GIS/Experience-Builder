System.register(["jimu-core","jimu-layouts/layout-runtime","jimu-ui/advanced/setting-components","jimu-ui","jimu-core/react","jimu-arcgis","jimu-theme"],(function(e,o){var t={},n={},r={},l={},s={},i={},a={};return{setters:[function(e){t.AppMode=e.AppMode,t.ClauseLogic=e.ClauseLogic,t.ClauseOperator=e.ClauseOperator,t.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,t.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,t.DataSourceComponent=e.DataSourceComponent,t.DataSourceFilterChangeMessage=e.DataSourceFilterChangeMessage,t.DataSourceManager=e.DataSourceManager,t.DataSourceStatus=e.DataSourceStatus,t.Immutable=e.Immutable,t.JimuFieldType=e.JimuFieldType,t.MessageManager=e.MessageManager,t.QueryScope=e.QueryScope,t.React=e.React,t.ReactRedux=e.ReactRedux,t.RecordSetChangeType=e.RecordSetChangeType,t.classNames=e.classNames,t.css=e.css,t.dataSourceUtils=e.dataSourceUtils,t.esri=e.esri,t.jsx=e.jsx,t.lodash=e.lodash,t.polished=e.polished},function(e){n.PageVisibilityContext=e.PageVisibilityContext,n.ViewVisibilityContext=e.ViewVisibilityContext},function(e){r.OutputDsAddress=e.OutputDsAddress,r.OutputDsObjectField=e.OutputDsObjectField,r.SearchServiceType=e.SearchServiceType},function(e){l.Button=e.Button,l.Checkbox=e.Checkbox,l.Dropdown=e.Dropdown,l.DropdownButton=e.DropdownButton,l.DropdownItem=e.DropdownItem,l.DropdownMenu=e.DropdownMenu,l.Icon=e.Icon,l.Link=e.Link,l.SVG=e.SVG,l.TextInput=e.TextInput,l.defaultMessages=e.defaultMessages,l.hooks=e.hooks},function(e){s.useEffect=e.useEffect},function(e){i.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){a.useTheme=e.useTheme}],execute:function(){e((()=>{var e={20864:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13 6.133c0 .598-.28 1.46-.825 2.51-.53 1.02-1.247 2.102-1.981 3.102A45.718 45.718 0 0 1 8 14.492a48.01 48.01 0 0 1-2.194-2.747c-.734-1-1.451-2.081-1.98-3.102C3.28 7.593 3 6.731 3 6.133 3 3.277 5.26 1 8 1s5 2.277 5 5.133Zm1 0c0 2.685-3.768 7.311-5.332 9.115C8.258 15.722 8 16 8 16s-.258-.279-.668-.752C5.768 13.444 2 8.819 2 6.133 2 2.746 4.686 0 8 0s6 2.746 6 6.133ZM10 5.5a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm1 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" fill="#000"></path></svg>'},59788:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z" fill="#000"></path></svg>'},96009:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .538.538 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.538.538 0 0 1 0 .738Z" fill="#000"></path></svg>'},55339:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746L8.746 8Z" fill="#000"></path></svg>'},30224:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0Zm-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707l-4.137-4.137Z" fill="#000"></path></svg>'},54357:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0v-6ZM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5Z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1Zm0 3V1H5v2h6Zm1.895 1h-9.79l.8 11h8.19l.8-11Z" fill="#000"></path></svg>'},79964:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2.125 14.334 14H1.667L8 2.125Zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47L7.118 1.653ZM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995Zm1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" fill="#000"></path></svg>'},26826:e=>{"use strict";e.exports=i},48891:e=>{"use strict";e.exports=t},51315:e=>{"use strict";e.exports=s},74758:e=>{"use strict";e.exports=n},34796:e=>{"use strict";e.exports=a},30726:e=>{"use strict";e.exports=l},77756:e=>{"use strict";e.exports=r}},o={};function c(t){var n=o[t];if(void 0!==n)return n.exports;var r=o[t]={exports:{}};return e[t](r,r.exports,c),r.exports}c.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return c.d(o,{a:o}),o},c.d=(e,o)=>{for(var t in o)c.o(o,t)&&!c.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:o[t]})},c.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var u={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(u),c.d(u,{default:()=>Ne});var e,o,t,n=c(48891),r=c(74758),l=c(77756);!function(e){e.ResultPanel="Result_Panel",e.OtherWidgets="Other_Widgets"}(e||(e={})),function(e){e.Style1="Style1",e.Style2="Style2"}(o||(o={})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(t||(t={}));var s=c(30726),i=c(51315);const a={_widgetLabel:"Search",showResult:"Show search results for {searchText}",hideResult:"Hide search results for {searchText}",allSearchSources:"All search sources",noResult:'No results found for "{searchText}"',couldNotRetrieve:"Could not retrieve current location.",showMoreResult:"Show more results",clearAllHistories:"Clear all histories",clearHistorie:"Clear history",clearThisHistories:"Remove this history",clearRecentSearches:"Recent searches",searchIn:"Search in {value}",searchResults:"Search result"};var d=c(59788),v=c.n(d);const g=e=>{const{className:o}=e,t=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)o.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(t[n[r]]=e[n[r]])}return t}(e,["className"]),r=(0,n.classNames)("jimu-icon jimu-icon-component",o);return n.React.createElement(s.SVG,Object.assign({className:r,src:v()},t))};var m=c(96009),p=c.n(m);const h=e=>{const{className:o}=e,t=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)o.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(t[n[r]]=e[n[r]])}return t}(e,["className"]),r=(0,n.classNames)("jimu-icon jimu-icon-component",o);return n.React.createElement(s.SVG,Object.assign({className:r,src:p()},t))},{useRef:f,useState:S}=n.React,y=e=>{const o=s.hooks.useTranslate(a,s.defaultMessages),t=n.css`
    & {
      box-sizing: border-box;
      width: ${n.polished.rem(32)}
    }
    .setting-dropdown-button {
      border-radius: 0;
      svg {
        margin: 0 !important;
      }
    }
  `,[r,l]=S(!0),[c,u]=n.React.useState(!1),{className:d,datasourceConfig:v,onDatasourceConfigChange:m}=e,p=f(null);return(0,i.useEffect)((()=>{var e;const o=0===(null===(e=null==v?void 0:v.filter((e=>!(null==e?void 0:e.enable))))||void 0===e?void 0:e.length);l(o)}),[v]),(0,n.jsx)("div",{className:`${d||""}`,css:t},(0,n.jsx)(s.Dropdown,{className:"w-100 h-100",toggle:e=>{var o;const t=null==e?void 0:e.target;if(null===(o=null==p?void 0:p.current)||void 0===o?void 0:o.contains(t))return!1;u(!c)},isOpen:c},(0,n.jsx)(s.DropdownButton,{className:"h-100 setting-dropdown-button",arrow:!1,icon:!0,title:o("searchIn",{value:""})},!c&&(0,n.jsx)(g,{size:16,className:"mr-1 d-inline-block",autoFlip:!0}),c&&(0,n.jsx)(h,{size:16,className:"mr-1 d-inline-block",autoFlip:!0})),(0,n.jsx)(s.DropdownMenu,{trapFocus:!1,autoFocus:!1,style:{maxHeight:"auto"}},(0,n.jsx)("div",{ref:p},(0,n.jsx)(s.DropdownItem,{onClick:()=>{const e=null==v?void 0:v.map((e=>{var o;return null===(o=e.setIn(["enable"],!0))||void 0===o?void 0:o.asMutable({deep:!0})}));m(e)},disabled:r},(0,n.jsx)(s.Checkbox,{checked:r,disabled:r,className:"mr-2"}),o("all")),(0,n.jsx)(s.DropdownItem,{divider:!0}),null==v?void 0:v.map(((e,o)=>{var t;const r=1===(null===(t=null==v?void 0:v.filter((e=>null==e?void 0:e.enable)))||void 0===t?void 0:t.length)&&(null==e?void 0:e.enable);return(0,n.jsx)(s.DropdownItem,{key:`${null==e?void 0:e.label}${o}`,disabled:r,onClick:()=>{((e,o)=>{var t;const n=null===(t=v)||void 0===t?void 0:t.setIn([o,"enable"],e);m(n)})(!(null==e?void 0:e.enable),o)}},(0,n.jsx)(s.Checkbox,{checked:null==e?void 0:e.enable,disabled:r,className:"mr-2"}),null==e?void 0:e.label)}))))))};var x=c(26826);const b={alias:"OBJECTID",type:"oid",name:l.OutputDsObjectField},I={alias:"ADDRESS",type:"string",name:l.OutputDsAddress},w=Object.assign(Object.assign({},I),{jimuName:l.OutputDsAddress}),j=(e,o)=>B(null==o?void 0:o.outputDataSourceId)?O(o,e):Promise.resolve({}),O=(e,o)=>N(null==e?void 0:e.geocodeURL,o,null==e?void 0:e.maxSuggestions).then((t=>{let n=[];t.forEach(((t,r)=>{const l=t.text;if(l&&!A(n,l)){const r={suggestionHtml:G(l,o),suggestion:l,configId:null==e?void 0:e.configId,magicKey:null==t?void 0:t.magicKey};n.push(r)}})),n=L(n,"suggestion");const r={suggestionItem:n.splice(0,e.maxSuggestions),layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon};return Promise.resolve(r)})).catch((e=>Promise.reject(e))),R=(e,o,t,r)=>{if(B(null==t?void 0:t.outputDataSourceId))return V(k(t.outputDataSourceId),n.DataSourceStatus.NotReady),D({address:e,maxResultNumber:o,searchResultView:r,geocodeItem:t})},D=e=>{const{address:o,maxResultNumber:t,geocodeItem:r}=e,{outputDataSourceId:s,singleLineFieldName:i}=r,a=k(s);return C(r,o,t,i).then((e=>(0,x.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer","esri/Graphic"]).then((t=>{const[r,i]=t,c=null==e?void 0:e.filter((e=>null==e?void 0:e.address));let u;const d=null==c?void 0:c.map(((e,o)=>{const t=e.attributes;return t.address=e.address,t.objectid=o,u=e.extent,new i({attributes:t,geometry:e.location})})),v=new r({id:`${s}_layer`,fields:[b,I],objectIdField:l.OutputDsObjectField,geometryType:"point",source:d,fullExtent:u});a.layer=v;const g=o?n.DataSourceStatus.Unloaded:n.DataSourceStatus.NotReady;return V(a,g),Promise.resolve(n.DataSourceStatus.Unloaded)})))).catch((e=>Promise.reject(e)))},C=(e,o,t,r)=>{const{geocodeURL:l,magicKey:s}=e;return(0,x.loadArcGISJSAPIModules)(["esri/tasks/Locator"]).then((e=>{const[i]=e,a=new i({url:l}),c=r||"SingleLine";let u=(0,n.Immutable)({maxSuggestions:t});return u=u.setIn([c],o),s&&(u=u.set("magicKey",s)),a.addressToLocations({address:null==u?void 0:u.asMutable({deep:!0})},{query:{}}).then((e=>(e=e.sort(((e,o)=>o.score-e.score))).filter((e=>e.location))),(e=>(console.error(e.message),[])))}))},N=(e,o,t)=>(0,x.loadArcGISJSAPIModules)(["esri/tasks/Locator"]).then((n=>{const[r]=n;return new r({url:e}).suggestLocations({text:o,maxSuggestions:t},{query:{}}).then((e=>e||[]),(e=>(console.error(e.message),[])))})),T=(e,o,t,r=!1)=>{const l=null==e?void 0:e.outputDataSourceId,s=k(null==e?void 0:e.outputDataSourceId),i={where:"1=1",pageSize:o,page:1,returnGeometry:!0};return null==s?void 0:s.load(i,{widgetId:t}).then((o=>(r&&M(l,t,[],n.RecordSetChangeType.Remove),setTimeout((()=>{r&&M(l,t,o)}),100),Promise.resolve({records:o,configId:e.configId,dsId:l,isGeocodeRecords:!0}))))},M=(e,o,t,r=n.RecordSetChangeType.Update)=>{const l=k(e),s=new n.DataRecordSetChangeMessage(o,e,r,{records:t,dataSource:l});n.MessageManager.getInstance().publishMessage(s)},P=(e,o,t,n=!1)=>{const r=[];for(const s in e){const i=e[s];let a;a=i.searchServiceType===l.SearchServiceType.FeatureService?J(i,o,t):T(i,o,t,n),r.push(a)}return Promise.all(r)},k=e=>e?n.DataSourceManager.getInstance().getDataSource(e):null,L=(e,o)=>{const t=e[0]?[e[0]]:[];for(let n=1;n<e.length;n++){const r=e[n];let l=!1;for(let e=0;e<t.length;e++)if(r[o]===t[e][o]){l=!0;break}l||t.push(r)}return t},F=e=>{const o=`${e}_recent_searches`;let t=localStorage.getItem(o);return t&&(t=unescape(t)),t?null==t?void 0:t.split("/@/"):[]},E=(e,o)=>{var t,n,r;return null===(r=null===(n=null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.datasourceConfig)||void 0===n?void 0:n.filter((e=>e.configId===o)))||void 0===r?void 0:r[0]},$=e=>{let o=0;for(const t in e)o++;return o};function A(e,o){return e.filter((e=>o===(null==e?void 0:e.suggestion))).length>0}function G(e,o){if(!o)return e;const t=new RegExp(`(${o})`,"gi"),n=new RegExp(`(${o})`,"gi");return e.match(t)?e.replace(n,"<strong >$1</strong>"):e}function V(e,o){e.setStatus(o),e.setCountStatus(o)}function B(e){return!!e&&!!k(e)}function _(e){return e?[-32,3]:[0,3]}var U=function(e,o,t,n){return new(t||(t=Promise))((function(r,l){function s(e){try{a(n.next(e))}catch(e){l(e)}}function i(e){try{a(n.throw(e))}catch(e){l(e)}}function a(e){var o;e.done?r(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(s,i)}a((n=n.apply(e,o||[])).next())}))};function H(e,o,t){var r,l;return U(this,void 0,void 0,(function*(){const s=(null==o?void 0:o.datasourceConfig)||[];if(!B(null===(r=null==t?void 0:t.useDataSource)||void 0===r?void 0:r.dataSourceId))return Promise.resolve({});const i=(null==t?void 0:t.searchFields)||[],a=null===(l=null==s?void 0:s.filter((e=>(null==e?void 0:e.configId)===t.configId)))||void 0===l?void 0:l[0];return function(e,o,t,r,l){var s;return U(this,void 0,void 0,(function*(){const{label:i,icon:a,configId:c}=t,u=null===(s=null==o?void 0:o.useDataSource)||void 0===s?void 0:s.dataSourceId,d=k(u),v=null==o?void 0:o.SQL,g={outFields:r.map((e=>e.name)),returnDistinctValues:!0,returnGeometry:!1,orderByFields:null};((null==v?void 0:v.sql)||"string"==typeof(null==v?void 0:v.sql))&&(g.where=null==v?void 0:v.sql);const m=new RegExp(`(${e})`,"gi");return function(e,o){return U(this,void 0,void 0,(function*(){return o?yield o.query(e,{scope:n.QueryScope.InRuntimeView}).then((e=>U(this,void 0,void 0,(function*(){return yield function(e,o){return U(this,void 0,void 0,(function*(){return yield Promise.resolve((null==o?void 0:o.records)||[])}))}(0,e)})))):yield Promise.resolve([])}))}(g,d).then((o=>U(this,void 0,void 0,(function*(){let t=[];r.forEach((n=>{o.forEach((o=>{var r;const l=(null===(r=null==o?void 0:o.feature)||void 0===r?void 0:r.attributes[null==n?void 0:n.name])+"";if(l&&!A(t,l)&&l.match(m)){const o={suggestionHtml:G(l,e),suggestion:l,configId:c,isFromSuggestion:!0};t.push(o)}}))})),t=L(t,"suggestion");const n={suggestionItem:t.splice(0,l),layer:i,icon:a};return Promise.resolve(n)})))).catch((e=>Promise.resolve({suggestionItem:[],layer:null,icon:null})))}))}(e,t,a,i,null==o?void 0:o.maxSuggestions)}))}function Z(e,o,t,r){if(o){const l=[];o.forEach((o=>{if(o.type===n.JimuFieldType.Number&&!Number(e))return!1;const t=function(e,o){let t;return e===n.JimuFieldType.Number?t=n.ClauseOperator.NumberOperatorIs:e===n.JimuFieldType.String&&(t=o?n.ClauseOperator.StringOperatorIs:n.ClauseOperator.StringOperatorContains),t}(o.type,r),s=o.type===n.JimuFieldType.Number?Number(e):e,i=n.dataSourceUtils.createSQLClause(null==o?void 0:o.name,t,s);l.push(i)}));const s=n.dataSourceUtils.createSQLExpression(n.ClauseLogic.Or,l);return n.dataSourceUtils.getArcGISSQL(s,t)}}function z(e,o,t){var r;const l=null===(r=null==e?void 0:e.useDataSource)||void 0===r?void 0:r.dataSourceId,s=k(l),i=null==e?void 0:e.SQL,a=t?(null==i?void 0:i.sql)||"1=0":"1=1",c=(0,n.Immutable)({outFields:["*"],where:a,returnGeometry:!0});s&&s.updateQueryParams(c,o)}const J=(e,o,t)=>{var n,r;const l=null===(n=null==e?void 0:e.useDataSource)||void 0===n?void 0:n.dataSourceId;if(!B(l))return Promise.resolve({});const s=k(l),i={where:(null===(r=null==e?void 0:e.SQL)||void 0===r?void 0:r.sql)||"1=0",pageSize:o,page:1,returnGeometry:!0};return null==s?void 0:s.load(i,{widgetId:t}).then((o=>Promise.resolve({records:o,configId:e.configId,dsId:l,isGeocodeRecords:!1})))};var q=c(54357),K=c.n(q);const Q=e=>{const{className:o}=e,t=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)o.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(t[n[r]]=e[n[r]])}return t}(e,["className"]),r=(0,n.classNames)("jimu-icon jimu-icon-component",o);return n.React.createElement(s.SVG,Object.assign({className:r,src:K()},t))};var W=c(20864),X=c.n(W);const Y=e=>{const{className:o}=e,t=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)o.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(t[n[r]]=e[n[r]])}return t}(e,["className"]),r=(0,n.classNames)("jimu-icon jimu-icon-component",o);return n.React.createElement(s.SVG,Object.assign({className:r,src:X()},t))};var ee=c(79964),oe=c.n(ee);const te=e=>{const{className:o}=e,t=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)o.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(t[n[r]]=e[n[r]])}return t}(e,["className"]),r=(0,n.classNames)("jimu-icon jimu-icon-component",o);return n.React.createElement(s.SVG,Object.assign({className:r,src:oe()},t))},{useState:ne}=n.React,re=e=>{const o=s.hooks.useTranslate(a,s.defaultMessages),{serviceList:t,onLocationChange:r}=e,[i,c]=ne(!1),[u,d]=n.React.useState(null);n.React.useEffect((()=>{v()}),[t]);const v=()=>{for(const e in t){const o=t[e];if(o.searchServiceType===l.SearchServiceType.GeocodeService){d(o);break}}},g=e=>{const o=`${e.coords.longitude},${e.coords.latitude}`;u?((e,o)=>o?(0,x.loadArcGISJSAPIModules)(["esri/tasks/Locator"]).then((t=>{const[n]=t,r=new n({url:e});return(e=>{const o=e&&e.coords;return o?(0,x.loadArcGISJSAPIModules)(["esri/geometry/Point"]).then((e=>{const[t]=e;return new t({longitude:o.longitude,latitude:o.latitude,z:o.altitude||null,spatialReference:{wkid:4326}})})):Promise.resolve(null)})(o).then((e=>r.locationToAddress({location:e},{query:{}}).then((e=>Promise.resolve(e.address)),(e=>(console.error(e.message),[])))))})):Promise.resolve(null))(null==u?void 0:u.geocodeURL,e).then((e=>{r(e)})):r(o)},m=()=>{c(!0)};return(0,n.jsx)("div",null,!i&&(0,n.jsx)(s.DropdownItem,{onClick:()=>{var e,o;e=g,o=m,navigator.geolocation?navigator.geolocation.getCurrentPosition(e,o):o&&o()}},(0,n.jsx)(Y,null),o("useCurrentLocation")),i&&(0,n.jsx)(s.DropdownItem,null,(0,n.jsx)(te,null),o("couldNotRetrieve")))};var le=c(34796);const se=(e,o)=>{var t,r,l,s,i,a,c,u,d,v,g,m,p,h,f,S,y,x;return n.css`
    & {
      max-height: ${n.polished.rem(300)};
      width: ${n.polished.rem(null===(t=null==o?void 0:o.current)||void 0===t?void 0:t.clientWidth)};
      overflow: auto;
      padding-top: 0;
      padding-bottom: 0;
      visibility: unset !important;
    }
    &.result-list-con .dropdown-item {
      text-overflow: ellipsis;
      white-space: pre-wrap;
    }
    &.result-list-con .dropdown-item:disabled {
      color: ${null===(s=null===(l=null===(r=null==e?void 0:e.colors)||void 0===r?void 0:r.palette)||void 0===l?void 0:l.secondary)||void 0===s?void 0:s[800]};
      background-color: ${null===(c=null===(a=null===(i=null==e?void 0:e.colors)||void 0===i?void 0:i.palette)||void 0===a?void 0:a.light)||void 0===c?void 0:c[200]};
      /* color: ${null===(u=null==e?void 0:e.colors)||void 0===u?void 0:u.black};
      background-color: ${null===(g=null===(v=null===(d=null==e?void 0:e.colors)||void 0===d?void 0:d.palette)||void 0===v?void 0:v.light)||void 0===g?void 0:g[100]}; */
    }
    &.result-list-con .dropdown-item:hover, &.result-list-con .dropdown-item:focus {
      color: ${null===(m=null==e?void 0:e.colors)||void 0===m?void 0:m.black};
      background-color: ${null===(f=null===(h=null===(p=null==e?void 0:e.colors)||void 0===p?void 0:p.palette)||void 0===h?void 0:h.light)||void 0===f?void 0:f[100]};
    }
    &.result-list-con .dropdown-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con .dropdown-item.active {
      background: ${null===(S=null==e?void 0:e.colors)||void 0===S?void 0:S.primary};
      color: ${null===(y=null==e?void 0:e.colors)||void 0===y?void 0:y.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:focus {
      background-color: ${null===(x=null==e?void 0:e.colors)||void 0===x?void 0:x.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
  `},{useRef:ie}=n.React,ae=new(0,n.esri.Sanitizer),ce=e=>{const o=s.hooks.useTranslate(a,s.defaultMessages),{isRecentSearches:t,className:r,reference:l,searchSuggestion:i,isOpen:c,searchText:u,canUseOutoutDsLength:d,serviceList:v,isShowCurrentLocation:g,config:m,toggel:p,onRecordItemClick:h,clearSearches:f,setSuggestionFirstItem:S}=e,y=(0,le.useTheme)(),x=ie(!1),b=(e,o)=>{0!==e||x.current||(S(o),x.current=!0)},I=(null==m?void 0:m.datasourceConfig)||[];return(0,n.jsx)("div",null,(0,n.jsx)(s.Dropdown,{className:"w-100",size:"lg",isOpen:c,toggle:p},(0,n.jsx)(s.DropdownButton,{className:"sr-only search-dropdown-button",style:{height:0,padding:0}}),(0,n.jsx)(s.DropdownMenu,{className:(0,n.classNames)("result-list-con",r),offset:_(I.length>1),trapFocus:!1,autoFocus:!1,css:se(y,l),style:{maxHeight:"auto"}},!u&&g&&(0,n.jsx)(re,{serviceList:v,isShowCurrentLocation:!0,onLocationChange:h}),(()=>{let e=[];return i.forEach((o=>{const t=(null==o?void 0:o.suggestionItem)||[];e=e.concat(t)})),u&&0===e.length})()&&(0,n.jsx)(s.DropdownItem,{className:"text-center",disabled:!0,title:o("noResult",{searchText:u})},o("noResult",{searchText:u})),(x.current=null,null==i?void 0:i.map(((e,o)=>{var t,r,l;const a=(null==i?void 0:i.length)>1&&(null===(t=null==e?void 0:e.suggestionItem)||void 0===t?void 0:t.length)>0;return(0,n.jsx)("div",{key:`${null==e?void 0:e.layer}-${o}`},a&&(0,n.jsx)(s.DropdownItem,{disabled:!0,title:null==e?void 0:e.layer},(null==e?void 0:e.icon)&&(0,n.jsx)(s.Icon,{className:"mr-2",color:null===(r=null==y?void 0:y.colors)||void 0===r?void 0:r.primary,size:16,icon:null===(l=null==e?void 0:e.icon)||void 0===l?void 0:l.svg}),null==e?void 0:e.layer),(e=>{const o=null==e?void 0:e.suggestionItem,t=null==e?void 0:e.icon;return null==o?void 0:o.map(((o,r)=>{var l;const i=ae.sanitize(o.suggestionHtml),a={configId:null==o?void 0:o.configId,isFromSuggestion:null==o?void 0:o.isFromSuggestion,magicKey:null==o?void 0:o.magicKey};return(0,n.jsx)(s.DropdownItem,{className:"d-flex align-items-center",key:`${null==e?void 0:e.layer}${r}`,title:o.suggestion,onClick:()=>{((e,o)=>{const{configId:t,isFromSuggestion:n,magicKey:r}=o||{};t&&(n||r)?h(e,o):h(e)})(o.suggestion,a)},ref:e=>{b(r,e)}},t&&1===d&&(0,n.jsx)(s.Icon,{className:"mr-2",color:null===(l=null==y?void 0:y.colors)||void 0===l?void 0:l.primary,size:16,icon:null==t?void 0:t.svg}),(0,n.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:i}}))}))})(e))}))),t&&(0,n.jsx)(s.DropdownItem,{divider:!0}),t&&(0,n.jsx)(s.DropdownItem,{title:o("clearRecentSearches"),type:"secondary",onClick:f},(0,n.jsx)(Q,null),o("clearRecentSearches")))))},{useEffect:ue,useRef:de}=n.React,ve=e=>{const o=s.hooks.useTranslate(a),{reference:t,searchText:r,id:i,config:c,serviceList:u,isOpentResultListDefault:d,setResultFirstItem:v,handleDsIdOfSelectedResultItemChange:m}=e,{resultMaxNumber:p}=c,f=de([]),S=de(!1),y=de(null),x=de(!1);let b={};const I=(0,le.useTheme)(),[j,O]=n.React.useState((0,n.Immutable)({})),[R,D]=n.React.useState({}),[C,N]=n.React.useState(null),[T,M]=n.React.useState(d),[L,F]=n.React.useState(!1);ue((()=>{A()}),[u]),ue((()=>{f.current=[]}),[r]);const A=()=>{S.current=!1;const e=P(null==u?void 0:u.asMutable({deep:!0}),p,i);Promise.all([e]).then((e=>{S.current=!0;let o=j||(0,n.Immutable)({}),t=[];null==e||e.forEach((e=>{t=t.concat(e)}));const r={};t.forEach((e=>{const{records:t,configId:n,dsId:l,isGeocodeRecords:s}=e;r[n]=t;const i=J(t,n,l,s);o=o.setIn([n],i)})),D(r),O(o),Q(),V()}))},G=(e,o)=>{0!==e||x.current||(v(o),x.current=!0)},V=()=>{var e;if(W())return;const o=[];for(const t in u){const n=u[t],r=(null==n?void 0:n.searchServiceType)===l.SearchServiceType.GeocodeService?null==n?void 0:n.outputDataSourceId:null===(e=null==n?void 0:n.useDataSource)||void 0===e?void 0:e.dataSourceId,s=B(r,t);s&&o.push(s)}const t=U(o,null==f?void 0:f.current);f.current=o,t&&t[0]?N(t[0]):N(null)},B=(e,o)=>{var t;const n=k(e).getSelectedRecords(),r=null===(t=null==n?void 0:n[0])||void 0===t?void 0:t.getId();return n&&r?K(o,r):null},U=(e,o)=>(null==e?void 0:e.length)>(null==o?void 0:o.length)?e.concat(o).filter((t=>!e.includes(t)||!o.includes(t)))||[]:e||[],H=e=>{const{isActive:o,recordId:t,dsId:r,configId:l}=e,s=k(r),a=o?[]:z(l,t);n.MessageManager.getInstance().publishMessage(new n.DataRecordsSelectionChangeMessage(i,a)),m(t?r:null),t&&(o?s.selectRecordsByIds([]):s.selectRecordsByIds([t]),!o&&Z(l))},Z=e=>{var o,t;for(const n in j)if(e!==n){const e=null===(t=null===(o=j[n])||void 0===o?void 0:o[0])||void 0===t?void 0:t.outputDsId,r=k(e);r&&r.selectRecordsByIds([])}},z=(e,o)=>{const t=(null==R?void 0:R[e])||[];return(null==t?void 0:t.filter((e=>(null==e?void 0:e.getId())===o)))||[]},J=(e,o,t,n)=>{var r;const l=(null===(r=null==u?void 0:u[o])||void 0===r?void 0:r.displayFields)||[],s=n?[w]:l,i=[];return null==e||e.forEach((e=>{const n=[];s.forEach((o=>{const t=e.getFieldValue(o.jimuName);t&&n.push(t)}));const r={value:n,configId:o,outputDsId:t,recordId:null==e?void 0:e.getId()};i.push(r),q(r)})),i},q=e=>{!(null==b?void 0:b.recordId)&&e.recordId&&(b=e)},K=(e,o)=>`${e}_${o}`,Q=()=>{if(!(null==c?void 0:c.isAutoSelectFirstResult)||!(null==b?void 0:b.recordId)||L)return;const{configId:e,recordId:o,outputDsId:t}=b,n=K(e,o);H({isActive:!1,key:n,recordId:o,dsId:t,configId:e}),F(!0)},W=()=>{var e;let o=0;for(const t in j)o+=(null===(e=null==j?void 0:j[t])||void 0===e?void 0:e.length)||0;return 0===o&&S.current};return(0,n.jsx)("div",null,(0,n.jsx)(s.Dropdown,{className:"w-100",size:"lg",isOpen:!0,toggle:e=>{var o;const t=null==e?void 0:e.target;if(null===(o=null==y?void 0:y.current)||void 0===o?void 0:o.contains(t))return!1;W()||M(!1)},"aria-expanded":!0},(0,n.jsx)(s.DropdownButton,{className:"sr-only search-dropdown-button",style:{height:0,padding:0}}),(0,n.jsx)(s.DropdownMenu,{className:"result-list-con",offset:_($(c.datasourceConfig)>1),trapFocus:!1,autoFocus:!1,css:se(I,t),style:{maxHeight:"auto"}},(0,n.jsx)("div",{ref:y},!W()&&(0,n.jsx)(s.DropdownItem,{className:"d-flex align-items-center show-result-button",onClick:()=>{M(!T)},title:o("searchResults")},(0,n.jsx)("div",{className:"flex-grow-1 font-weight-bold"},o("searchResults")),!T&&r?(0,n.jsx)(g,null):(0,n.jsx)(h,null)),T&&(0,n.jsx)("div",null,!W()&&(0,n.jsx)(s.DropdownItem,{divider:!0}),W()&&(0,n.jsx)(s.DropdownItem,{className:"text-center",disabled:!0,title:o("noResult",{searchText:r})},o("noResult",{searchText:r})),!W()&&(()=>{var e,o;const t=[];x.current=null;for(const l in j){const i=null===(e=null==j?void 0:j.asMutable({deep:!0}))||void 0===e?void 0:e[l],a=E(c,l),d=null==a?void 0:a.label,v=null==a?void 0:a.icon,g=$(u),m=(0,n.jsx)("div",{key:`${l}_${d}_con`},i.length>0&&(0,n.jsx)("div",null,g>1&&(0,n.jsx)(s.DropdownItem,{disabled:!0,key:`${l}_${d}`,title:d},v&&(0,n.jsx)(s.Icon,{className:"mr-2",color:null===(o=null==I?void 0:I.colors)||void 0===o?void 0:o.primary,size:16,icon:null==v?void 0:v.svg}),d),null==(r=i)?void 0:r.map(((e,o)=>{var t,r;const{configId:l,value:i,recordId:a,outputDsId:d}=e,v=K(l,a),g=C===v,m=E(c,l),p=null==m?void 0:m.icon,h=g?null===(t=null==I?void 0:I.colors)||void 0===t?void 0:t.white:null===(r=null==I?void 0:I.colors)||void 0===r?void 0:r.primary,f=$(u);return(0,n.jsx)(s.DropdownItem,{className:"d-flex align-items-center",key:v,active:g,title:i.join(", "),ref:e=>{G(o,e)},onClick:()=>{H({isActive:g,key:v,recordId:a,dsId:d,configId:l})}},p&&1===f&&(0,n.jsx)(s.Icon,{className:"mr-2",color:h,size:16,icon:null==p?void 0:p.svg}),(0,n.jsx)("div",null,i.join(", ")))}))));t.push(m)}var r;return t})())))))};var ge=c(30224),me=c.n(ge);const pe=e=>{const{className:o}=e,t=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)o.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(t[n[r]]=e[n[r]])}return t}(e,["className"]),r=(0,n.classNames)("jimu-icon jimu-icon-component",o);return n.React.createElement(s.SVG,Object.assign({className:r,src:me()},t))};var he=c(55339),fe=c.n(he);const Se=e=>{const{className:o}=e,t=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)o.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(t[n[r]]=e[n[r]])}return t}(e,["className"]),r=(0,n.classNames)("jimu-icon jimu-icon-component",o);return n.React.createElement(s.SVG,Object.assign({className:r,src:fe()},t))},{useSelector:ye}=n.ReactRedux,{useState:xe,useEffect:be,useRef:Ie,useMemo:we}=n.React,je=t=>{var r,i,c,u,d,v;const g=s.hooks.useTranslate(a,s.defaultMessages),m=(0,le.useTheme)(),p=ye((e=>null==e?void 0:e.queryObject)),h=ye((e=>{var o;return null===(o=null==e?void 0:e.appRuntimeInfo)||void 0===o?void 0:o.appMode})),f=Ie((e=>{})),S=Ie(null),y=Ie(null),x=Ie(null),b=Ie(null),I=Ie(!1),w=Ie(null),{config:O,className:D,reference:C,id:N,datasourceConfig:T,isShowSearchInput:L,isInCurrentView:E,isWidgetInCurrentPage:A,onShowSearchInputChange:G}=t,{isShowRecentSearches:_,recentSearchesMaxNumber:U,linkParam:J,searchResultView:q,resultMaxNumber:K,arrangementStyle:Q}=O,[W,X]=xe(null),[Y,ee]=xe(!1),[oe,te]=xe(!1),[ne,re]=xe(!1),[se,ie]=xe({}),[ae,ue]=xe({}),[de,ge]=xe([]),[me,he]=xe(!1),[fe,je]=xe(!1),[Oe,Re]=xe(null),De=n.css`
    .input-wrapper {
      height: 100% !important;
    }
    .loading-con {
      @keyframes loading {
        0% {transform: rotate(0deg); };
        100% {transform: rotate(360deg)};
      }
      width: ${n.polished.rem(16)};
      height: ${n.polished.rem(16)};
      min-width: ${n.polished.rem(16)};
      border: 2px solid ${null===(c=null===(i=null===(r=null==m?void 0:m.colors)||void 0===r?void 0:r.palette)||void 0===i?void 0:i.secondary)||void 0===c?void 0:c[300]};
      border-radius: 50%;
      border-top: 2px solid ${null===(v=null===(d=null===(u=null==m?void 0:m.colors)||void 0===u?void 0:u.palette)||void 0===d?void 0:d.primary)||void 0===v?void 0:v[500]};
      box-sizing: border-box;
      animation:loading 2s infinite linear;
      box-sizing: border-box;
    }
    .search-button {
      width: ${n.polished.rem(32)};
      border-radius: 0;
    }
    .search-input-con input{
      width: 100%;
    }
    .search-link-con {
      width: 0;
      height: 0;
      overflow: hidden;
    }
  `;be((()=>{Ue()}),[T]),be((()=>{I.current&&E&&A?(je(!1),n.lodash.defer((()=>{Ne(!0)}))):je(!0),E&&A||he(!1)}),[E,A]),be((()=>{me&&h===n.AppMode.Design&&he(!1)}),[h]),be((()=>{f.current=n.lodash.debounce((e=>{const o=((e,o,t)=>{const n=[];for(const r in o){const s=o[r];let i;i=s.searchServiceType===l.SearchServiceType.FeatureService?H(e,t,s):j(e,s),n.push(i)}return Promise.all(n)})(e,ae,O);Promise.all([o]).then((e=>{const o=null==e?void 0:e[0];ee(!1),o&&ge(o),b.current&&te(!0)})).catch((e=>{ee(!1)}))}),400)}),[ae,O]);const Ce=()=>{var e,o;for(const t in ae)if((null===(e=ae[t])||void 0===e?void 0:e.searchServiceType)===l.SearchServiceType.GeocodeService){const e=null===(o=ae[t])||void 0===o?void 0:o.outputDataSourceId,r=k(e);r.selectRecordsByIds([]),V(r,n.DataSourceStatus.NotReady),M(e,N,[],n.RecordSetChangeType.Remove)}},Ne=e=>{I.current=e,e||je(!0),he(e)},Te=()=>{let e=!0;if(!w.current)return e;const o=w.current;for(const t in o){const n=o[t];if(e=!((null==n?void 0:n.magicKey)||(null==n?void 0:n.isFromSuggestion)),!e)break}return e},Me=(o,t=!1)=>{if(me&&!t)return;Ae(o),te(!1);const n={serviceList:w.current,searchText:o,searchResultView:q,id:N};Pe(),(o=>{const{serviceList:t,searchText:n,searchResultView:r,id:s}=o,i=[];for(const o in t){const a=t[o],{searchServiceType:c,resultMaxNumber:u}=a;if(c===l.SearchServiceType.FeatureService)z(a,s,n);else if(c===l.SearchServiceType.GeocodeService){const o=r===e.ResultPanel?u:null,t=R(n,o,a,r);i.push(t)}}return Promise.all(i)})(n).then((e=>{ke(),o&&Le(o)}))},Pe=()=>{if(n.MessageManager.getInstance().publishMessage(new n.DataRecordsSelectionChangeMessage(N,[])),Oe){const e=k(Oe);null==e||e.selectRecordsByIds([])}},ke=()=>{var e;const o=w.current;for(const t in o){const r=o[t];let s;(null==r?void 0:r.searchServiceType)===l.SearchServiceType.FeatureService?s=null===(e=null==r?void 0:r.useDataSource)||void 0===e?void 0:e.dataSourceId:(null==r?void 0:r.searchServiceType)===l.SearchServiceType.GeocodeService&&(s=null==r?void 0:r.outputDataSourceId),n.MessageManager.getInstance().publishMessage(new n.DataSourceFilterChangeMessage(N,s))}},Le=o=>{q===e.OtherWidgets?(Ve(),o&&($e()?Ge():Fe())):Ee()},Fe=()=>{const e=P(w.current,K,N);Promise.all([e]).then((e=>{let o=[],t=[];null==e||e.forEach((e=>{o=o.concat(e)})),o.forEach((e=>{const o=(null==e?void 0:e.records)||[];t=t.concat(o)})),(null==t?void 0:t.length)>0?Ge():Ee()}))},Ee=()=>{P(w.current,K,N,!0),Ne(!0)},$e=()=>{let e=[];return de.forEach((o=>{e=e.concat(null==o?void 0:o.suggestionItem)})),e.length>0},Ae=e=>{(e=>{const{searchText:o,id:t,recentSearchesMaxNumber:n,isShowRecentSearches:r}=e,l=`${t}_recent_searches`;if(!r||!o)return!1;let s=F(t);s.includes(o)||(s.unshift(o),s=s.splice(0,n||10),localStorage.setItem(l,escape(s.join("/@/"))))})({searchText:e,id:N,recentSearchesMaxNumber:U,isShowRecentSearches:_})},Ge=()=>{var e;if(!(null==S?void 0:S.current))return!1;null===(e=null==S?void 0:S.current)||void 0===e||e.click()},Ve=()=>{const o=q===e.ResultPanel?K:null,t=P(w.current,o,N,!0);Promise.all([t])},Be=we((()=>(e=>{let o,t;return(null==e?void 0:e.linkType)&&(o=null==e?void 0:e.openType,t={linkType:null==e?void 0:e.linkType},t.value=null==e?void 0:e.value),{linkTo:t,target:o}})(J)),[J]),_e=(e,o)=>{ne&&re(!1),ge([]),X(e),b.current=e,ze(e,o)},Ue=()=>{var e;let o=(0,n.Immutable)({});null===(e=null==T?void 0:T.asMutable({deep:!0}))||void 0===e||e.forEach((e=>{if(!(null==e?void 0:e.enable))return!1;const{configId:t}=e;let n;n=(null==e?void 0:e.searchServiceType)===l.SearchServiceType.GeocodeService?Ze(e):He(e),o=o.setIn([t],n)})),ue(null==o?void 0:o.asMutable({deep:!0}))},He=e=>{if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===l.SearchServiceType.GeocodeService)return!1;const{configId:o,useDataSource:t,displayFields:n,searchFields:r,searchExact:s,hint:i,searchServiceType:a}=e,c=(null==ae?void 0:ae[o])||{},u={useDataSource:t,displayFields:n,searchFields:r,searchExact:s,maxSuggestions:null==O?void 0:O.maxSuggestions,resultMaxNumber:K,hint:i,searchServiceType:a,configId:o};return Object.assign(c,u)},Ze=e=>{if(!(null==e?void 0:e.enable)||(null==e?void 0:e.searchServiceType)===l.SearchServiceType.FeatureService)return!1;const{configId:o,hint:t,geocodeURL:n,outputDataSourceId:r,label:s,searchServiceType:i,singleLineFieldName:a}=e,c=(null==ae?void 0:ae[o])||{},u={hint:t,geocodeURL:n,outputDataSourceId:r,icon:null==e?void 0:e.icon,maxSuggestions:null==O?void 0:O.maxSuggestions,resultMaxNumber:K,label:s,searchServiceType:i,configId:o,singleLineFieldName:a||""};return Object.assign(c,u)},ze=(e,o)=>{var t,r;const s=ae;for(const o in ae){const n=null===(r=null===(t=ae[o])||void 0===t?void 0:t.useDataSource)||void 0===r?void 0:r.dataSourceId;if(ae[o].searchServiceType===l.SearchServiceType.GeocodeService||!B(n))continue;const i=k(n),a=Z(e,ae[o].searchFields||[],i,ae[o].searchExact||!1);s[o].SQL=a}ue(s),((e,o)=>{const{configId:t,magicKey:r,isFromSuggestion:l}=o||{};let s=t?(0,n.Immutable)({}).setIn([t],e[t]):(0,n.Immutable)(e);for(const e in s)r&&(s=s.setIn([e,"magicKey"],r||null)),l&&(s=s.setIn([e,"isFromSuggestion"],l||null));w.current=null==s?void 0:s.asMutable({deep:!0}),ie(null==s?void 0:s.asMutable({deep:!0}))})(s,o)},Je=e=>{if(!e&&_){const e=F(N);if(0===(null==e?void 0:e.length))return!1;const o=e.map((e=>({suggestionHtml:e,suggestion:e,isRecentSearche:!0})));ge([{suggestionItem:o,layer:null,icon:null}]),te(!0),re(!0)}},qe=()=>$(ae),Ke=oe&&!Y&&!me,Qe=e=>{var o,t;40===e.keyCode&&y&&(Ke?null===(o=null==y?void 0:y.current)||void 0===o||o.focus():me&&(null===(t=null==x?void 0:x.current)||void 0===t||t.focus()))};return(0,n.jsx)("div",{className:`h-100 align-items-center d-flex flex-grow-1 ${D||""}`,css:De},(0,n.jsx)("div",{className:"h-100 flex-grow-1 search-input-con"},(0,n.jsx)("div",{className:"h-100 w-100",onKeyUp:e=>{Qe(e)}},L&&(0,n.jsx)(s.TextInput,{value:W||"",onChange:e=>{var o;const t=null===(o=null==e?void 0:e.target)||void 0===o?void 0:o.value,n=(null==t?void 0:t.length)>2;if(_e(t),Ne(!1),!n)return te(!1),!1;!Y&&ee(!0),f.current(t)},onFocus:e=>{var o;const t=null===(o=null==e?void 0:e.target)||void 0===o?void 0:o.value;Je(t),t||!(null==O?void 0:O.isUseCurrentLoation)||oe||(te(!0),Je||ge([{suggestionItem:[],layer:null,icon:null}]))},onKeyUp:e=>{var o;if(!e||!e.target)return;const t=null===(o=null==e?void 0:e.target)||void 0===o?void 0:o.value;13===e.keyCode&&Te()&&(_e(t),Me(t)),Qe(e)},className:"h-100 w-100",suffix:(0,n.jsx)("div",{className:"d-flex align-items-center"},Y&&(0,n.jsx)("div",{className:"loading-con mr-1"}),W&&(null==W?void 0:W.length)>0&&(0,n.jsx)(s.Button,{icon:!0,type:"tertiary",size:"sm",onClick:()=>{_e(""),Ce(),ee(!1),Ne(!1),Me("",!0)}},(0,n.jsx)(Se,null))),placeholder:(()=>{var e,o;let t;const n=qe();for(const n in ae)t=(null===(e=null==ae?void 0:ae[n])||void 0===e?void 0:e.hint)&&(null===(o=null==ae?void 0:ae[n])||void 0===o?void 0:o.hint);const r=(null==O?void 0:O.hint)||g("findAddressOrPlace");return t=t||g("findAddressOrPlace"),1!==n?r:t})()})),(0,n.jsx)(ce,{serviceList:(0,n.Immutable)(se),canUseOutoutDsLength:qe(),isOpen:(()=>{if((null==O?void 0:O.maxSuggestions)>0)return Ke;{const e=!W&&(null==O?void 0:O.isUseCurrentLoation)||ne;return Ke&&e}})(),reference:C,searchText:W,searchSuggestion:de,toggel:()=>{te(!oe)},onRecordItemClick:(e,o)=>{_e(e,o),Me(e)},isRecentSearches:ne,clearSearches:()=>{(e=>{const o=`${e}_recent_searches`;localStorage.setItem(o,"")})(N),ge([]),te(!1),re(!1)},isShowCurrentLocation:null==O?void 0:O.isUseCurrentLoation,setSuggestionFirstItem:e=>{y.current=e},config:O}),me&&(0,n.jsx)(ve,{serviceList:(0,n.Immutable)(se),config:O,reference:C,searchText:W,id:N,setResultFirstItem:e=>{x.current=e},isOpentResultListDefault:fe,handleDsIdOfSelectedResultItemChange:e=>{Re(e)}})),(0,n.jsx)(s.Button,{className:"search-button h-100",type:"primary",icon:!0,onClick:()=>{(e=>{Q===o.Style2?(G(!L),te(!1)):Te()&&Me(e)})(W)},title:g("SearchLabel")},(0,n.jsx)(pe,null)),q===e.OtherWidgets&&(0,n.jsx)("div",{className:"search-link-con"},(0,n.jsx)(s.Link,{ref:S,to:null==Be?void 0:Be.linkTo,target:null==Be?void 0:Be.target,queryObject:p})))},Oe=e=>{const{datasourceConfig:o,id:t}=e;return(0,n.jsx)("div",null,null==o?void 0:o.map((e=>(e=>{const{configId:o}=e,r=null==e?void 0:e.outputDataSourceId,l=null==e?void 0:e.useDataSource,s={dataSourceId:r,mainDataSourceId:r};return(0,n.jsx)("div",{key:`${o}_con`},l&&(0,n.jsx)(n.DataSourceComponent,{useDataSource:(0,n.Immutable)(l),query:null,key:`${o}_useDataSource`,widgetId:t}),r&&(0,n.jsx)(n.DataSourceComponent,{useDataSource:(0,n.Immutable)(s),query:null,key:`${o}_outputDataSource`,widgetId:t}))})(e))))},{useEffect:Re,useState:De,useRef:Ce}=n.React,Ne=e=>{const{config:t,id:l}=e,s=Ce(null),[i,a]=De((0,n.Immutable)([])),[c,u]=De(!1);Re((()=>{g()}),[t]);const d=n.css`
    & {
      height: ${n.polished.rem(32)};
      margin-top: 1px;
      margin-left: 1px;
    }
  `,v=e=>{e&&a(e)},g=()=>{const e=(null==t?void 0:t.datasourceConfig)||(0,n.Immutable)([]),o=[];e.forEach((e=>{var t;const n=null===(t=e)||void 0===t?void 0:t.setIn(["enable"],!0);o.push(n)})),a((0,n.Immutable)(o))},m=()=>(null==t?void 0:t.arrangementStyle)===o.Style1||c,p=e=>{u(e)};return(0,n.jsx)(r.ViewVisibilityContext.Consumer,null,(({isInView:e,isInCurrentView:o})=>{const a=!e||o;return(0,n.jsx)(r.PageVisibilityContext.Consumer,null,(e=>{var o;return(0,n.jsx)("div",{className:"widget-search jimu-widget"},(0,n.jsx)("div",{className:"d-flex w-100 align-items-center",css:d,ref:s},(0,n.jsx)("div",null,(null===(o=null==t?void 0:t.datasourceConfig)||void 0===o?void 0:o.length)>1&&m()&&(0,n.jsx)(y,{className:"h-100",config:t,datasourceConfig:i,onDatasourceConfigChange:v})),(0,n.jsx)(je,{id:l,className:"flex-grow-1 h-100",reference:s,datasourceConfig:i,config:t,isShowSearchInput:m(),onShowSearchInputChange:p,isInCurrentView:a,isWidgetInCurrentPage:e}),(0,n.jsx)(Oe,{id:l,datasourceConfig:i})))}))}))}})(),u})())}}}));